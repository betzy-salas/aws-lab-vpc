CREAR EL SERVICIO

Ahora se creará un servicio que consulte los datos almacenados en la tabla dynamobd MyPets y retorne la información en formato json

Para ello, crearemos el servicio contenerizado

CREAR SERVICIO CONTENERIZADO

1) Ubicarse en la carpeta 03-service
2) Crear la imagen de docker reemplazando los valores.  Estos valores se encuentran en el stack de cloudFormation o directamente en los recursos

****NOTA: AL CREAR LA IMAGEN SE ENTREGARA EL TAG********
docker build . -t REPLACE_ME_AWS_ACCOUNT_ID.dkr.ecr.REPLACE_ME_REGION.amazonaws.com/mypets/service:latest

Ejemplo
docker build . -t 757681054660.dkr.ecr.us-east-1.amazonaws.com/mypets/service:latest

3) Correr la imagen de docker de forma local (Probablemente este servicio no va funcionar correctamente por temas de permisos)

docker run -p 8080:8080 REPLACE_ME_WITH_DOCKER_IMAGE_TAG
docker run -p 8080:8080 757681054660.dkr.ecr.us-east-1.amazonaws.com/mypets/service:latest

SUBIR LA IMAGEN DEL CONTENEDOR EN ECR
4) Ejecutar el siguiente comando
$(aws ecr get-login --no-include-email)

docker push REPLACE_ME_WITH_DOCKER_IMAGE_TAG
docker push 757681054660.dkr.ecr.us-east-1.amazonaws.com/mypets/service:latest
aws ecr describe-images --repository-name mypets/service

CREAR EL LOG GROUP EN CLOUF WATCH
5) Una vez se tenga la imagen en ECR, crear manualmente los logs en cloud watch  (mypets-logs)

Si lo prefiere ejecute el siguiente comando para crearlo usando las apis que ofrece AWS
aws logs create-log-group --log-group-name mypets-logs

CREAR EL CLUSTER DE ECS PARA ALOJAR EL SERVICIO
los siguientes pasos se crean basados en las imagenes que se encuentran en la carpeta images

6) Cree un rol vinculado al servicio para ECS.  Si genera error es porque ya lo tiene creado.
aws iam create-service-linked-role --aws-service-name ecs.amazonaws.com

7) Crear manualmente el cluster en ECS
8) Crear la task teniendo presente los componentes de arquitectura (Los servicios van a ir alojados en la subred privada)
9) Crear el service teniendo presente los componentes de arquitectura

PROBAR EL SERVICIO
10) Abra la dirección del DNS asociado al balanceador de carga

